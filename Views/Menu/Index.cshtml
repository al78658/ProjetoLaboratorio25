@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard de Resultados</title>
    <style>
        * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        }

        body {
        font-family: Arial, sans-serif;
        background-color: #808080;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px 16px;
        position: relative;
        }

        .top-left-logo {
        position: absolute;
        top: 40px;
        left: 50px;
        }

        .top-left-logo img {
        width: 160px;
        }

        .back-button {
        position: fixed;
        right: 40px;
        bottom: 40px;
        z-index: 2000;
        padding: 10px 22px;
        font-size: 18px;
        border: 2px solid #000;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        color: black;
        }

        .back-button:hover {
        background-color: #dcdcdc;
        }
        
        /* Estilos para o menu lateral de edi√ß√£o */
        .edit-sidebar {
            position: fixed;
            right: 20px;
            top: 120px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 20px;
            width: 250px;
            z-index: 100;
        }
        
        .edit-sidebar-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .edit-sidebar-steps {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .edit-sidebar-step {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 6px;
            background-color: #f8f9fa;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        
        .edit-sidebar-step:hover {
            background-color: #e9ecef;
        }
        
        .edit-sidebar-step.active {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        
        .edit-sidebar-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .edit-sidebar-text {
            font-size: 14px;
        }

        h2 {
        font-size: 30px;
        color: black;
        margin: 24px 0 16px;
        text-align: center;
        }

        .content-wrapper {
        max-width: 940px;
        width: 100%;
        }

        .table-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 12px;
        justify-content: flex-end;
        }

        .table-buttons button {
        padding: 8px 16px;
        border: 2px solid black;
        background: white;
        border-radius: 8px;
        font-size: 15px;
        cursor: pointer;
        }

        .table-buttons button:hover {
        background-color: #e0e0e0;
        }

        table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        margin-bottom: 32px;
        }

        th, td {
        padding: 10px;
        border: 1px solid #888;
        text-align: center;
        font-size: 15px;
        }

        th {
        background-color: #ccc;
        }

        tr:nth-child(even) {
        background-color: #f2f2f2;
        }

        .form-box {
        display: inline-block;
        width: 22px;
        height: 22px;
        line-height: 22px;
        text-align: center;
        border-radius: 4px;
        font-weight: bold;
        color: white;
        margin: 0 2px;
        font-size: 14px;
        }

        .form-v {
        background-color: green;
        }

        .form-e {
        background-color: yellow;
        color: black;
        }

        .form-d {
        background-color: red;
        }

        .section {
        margin-top: 30px;
        }

        .result-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        gap: 10px;
        }

        .result-nav .left-buttons {
        display: flex;
        gap: 10px;
        flex-direction: row-reverse;
        }

        .result-nav button, .result-nav span {
        padding: 8px 16px;
        border: 2px solid black;
        background: white;
        border-radius: 8px;
        font-size: 15px;
        cursor: pointer;
        }

        .result-nav button:hover {
        background-color: #e0e0e0;
        }

        .date-navigation {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

            .date-navigation button {
                padding: 6px 14px;
                border: 2px solid black;
                background: white;
                border-radius: 8px;
                cursor: pointer;
                font-size: 18px;
            }

        #selectedDateDisplay {
            font-weight: bold;
        }
        
        .jogo-realizado {
            background-color: #e8f5e9 !important;
        }
        
        .jogo-realizado td {
            font-weight: bold;
        }

        media (max-width: 768px) {
            .table-buttons, .result-nav {
                flex-direction: column;
                align-items: stretch;
            }

            .table-buttons button,
            .result-nav button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="top-left-logo">
        <a href="/home">
            <img src="@Url.Content("~/img/logotipo.png")" alt="Logotipo" />
        </a>
    </div>
    
    <!-- Menu lateral de edi√ß√£o (vis√≠vel apenas para administradores) -->
    @if (User.Identity.IsAuthenticated)
    {
        <div class="edit-sidebar" id="editSidebar" style="display: none;">
            <div class="edit-sidebar-title">
                Editar Competi√ß√£o
                <div style="font-size: 14px; font-weight: normal; margin-top: 5px;" id="competicaoNomeDisplay"></div>
            </div>
            <div class="edit-sidebar-steps">
                <a class="edit-sidebar-step" onclick="irParaEtapa('CriarCompeticao')">
                    <span class="edit-sidebar-icon">üìù</span>
                    <span class="edit-sidebar-text">Definir Competi√ß√£o</span>
                </a>
                <a class="edit-sidebar-step" onclick="irParaEtapa('FormatodaCompeticao')">
                    <span class="edit-sidebar-icon">üèÜ</span>
                    <span class="edit-sidebar-text">Formato da Competi√ß√£o</span>
                </a>

                <a class="edit-sidebar-step" onclick="irParaEtapa('ListadeJogadores')">
                    <span class="edit-sidebar-icon">üë•</span>
                    <span class="edit-sidebar-text">Lista de Jogadores</span>
              </a>
                <a class="edit-sidebar-step" onclick="irParaEtapa('Emparelhamento')">
                    <span class="edit-sidebar-icon">üîÑ</span>
                    <span class="edit-sidebar-text">Emparelhamento</span>
                </a>
              </div>
        </div>
    }

    <div class="content-wrapper">
        <!-- Tabela Classificativa -->
        <h2>Tabela Classificativa</h2>
        <div class="table-buttons">
            @if (User.Identity.IsAuthenticated)
            {
                <script>
                    // Fun√ß√£o para obter par√¢metros da URL
                    function getQueryParam(name) {
                        const params = new URLSearchParams(window.location.search);
                        return params.get(name);
                    }

                    // Guardar o ID da competi√ß√£o
                    const competicaoId = getQueryParam('competicaoId');
                    
                    // Salvar o ID no localStorage se existir
                    if (competicaoId) {
                        localStorage.setItem('competicaoId', competicaoId);
                    }

                    // Fun√ß√£o para editar competi√ß√£o atual
                    function editarCompeticaoAtual() {
                        // Primeiro tenta obter do localStorage
                        let id = localStorage.getItem('competicaoId');
                        
                        // Se n√£o encontrar no localStorage, tenta da URL
                        if (!id) {
                            id = getQueryParam('competicaoId');
                            if (id) {
                                localStorage.setItem('competicaoId', id);
                            }
                        }
                        
                        if (!id) {
                            alert('ID da competi√ß√£o n√£o encontrado. Por favor, selecione uma competi√ß√£o primeiro.');
                            return;
                        }
                        
                        window.location.href = `/FormatodaCompeticao?edicao=true&competicaoId=${id}`;
                    }
                </script>

                <button type="button" class="login-button" onclick="window.location.href = `/CriarRelatorio?competicaoId=${competicaoId}`;">
                    Criar Relat√≥rio
                </button>
                <button type="button" class="login-button" onclick="editarCompeticaoAtual()">
                    Editar Competi√ß√£o
                </button>
            }
            <button type="button" class="login-button" onclick="consultarRelatorios()">
                Consultar Relat√≥rios
            </button>

            <script>
                function getQueryParam(name) {
                    const params = new URLSearchParams(window.location.search);
                    return params.get(name);
                }

                function consultarRelatorios() {
                    const competicaoId = getQueryParam('competicaoId');
                    if (competicaoId) {
                        window.location.href = `/PesquisarRelatorio?competicaoId=${competicaoId}`;
                    } else {
                        window.location.href = `/PesquisarRelatorio`;
                    }
                }
            </script>
            <button type="button" class="login-button" onclick="irParaProximosJogos()">
                Jogos Agendados
            </button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Lugar</th>
                    <th>Nome</th>
                    <th>Jogos</th>
                    <th>Vit√≥rias</th>
                    <th>Empates</th>
                    <th>Derrotas</th>
                    <th>Frames</th>
                    <th>Pontua√ß√£o</th>
                    <th>Forma</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="9">Carregando dados...</td>
                </tr>
            </tbody>
        </table>

        <!-- Resultados -->
        <div class="section">
            <h2>Resultados</h2>
            <div class="table-buttons">
                <div>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <button type="button" class="login-button" onclick="irParaPontuacoes()">
                            Alterar Resultados
                        </button>

                    }
                    <button type="button" class="login-button" onclick="window.location.href='/Historico?competicaoId=' + competicaoId">
                        Hist√≥rico
                    </button>
                        <button id="prevDayBtn">&lt;</button>
                        <span id="selectedDateDisplay"></span>
                        <button id="nextDayBtn">&gt;</button>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Partidas</th>
                        <th>Hor√°rio</th>
                        <th>Resultado</th>
                        <th>Motivo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="4">Carregando dados...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <a href="/Competicoes/Index" class="back-button">Competi√ß√µes</a>
    <script>
        // Fun√ß√£o para mostrar/esconder o menu lateral de edi√ß√£o
        function toggleEditSidebar() {
            const sidebar = document.getElementById('editSidebar');
            if (sidebar.style.display === 'none') {
                // Carregar dados da competi√ß√£o atual
                carregarDadosCompeticaoAtual();
                sidebar.style.display = 'block';
            } else {
                sidebar.style.display = 'none';
            }
        }
        
        // Fun√ß√£o para carregar dados da competi√ß√£o atual
        function carregarDadosCompeticaoAtual() {
            const nomeCompeticao = localStorage.getItem('competicaoSelecionada');
            if (!nomeCompeticao) {
                alert('Nenhuma competi√ß√£o selecionada.');
                return false;
            }
            
            // Exibir o nome da competi√ß√£o no menu lateral
            document.getElementById('competicaoNomeDisplay').textContent = nomeCompeticao;
            
            // Buscar dados da competi√ß√£o no localStorage
            let competicaoId = null;
            let dadosCompeticao = null;
            
            // Procurar a competi√ß√£o pelo nome
            for (let i = 0; i < localStorage.length; i++) {
                const chave = localStorage.key(i);
                if (chave.startsWith('competicao_')) {
                    try {
                        const comp = JSON.parse(localStorage.getItem(chave));
                        if (comp.nome === nomeCompeticao) {
                            competicaoId = comp.id;
                            dadosCompeticao = comp;
                            break;
                        }
                    } catch (e) {
                        console.error('Erro ao processar competi√ß√£o:', e);
                    }
                }
            }
            
            if (!competicaoId || !dadosCompeticao) {
                // Se n√£o encontrou pelo nome, tentar criar um ID baseado no nome
                competicaoId = nomeCompeticao.toLowerCase().replace(/[^a-z0-9]/g, '_');
                
                // Criar objeto b√°sico da competi√ß√£o
                dadosCompeticao = {
                    id: competicaoId,
                    nome: nomeCompeticao,
                    tipo: 'individual' // valor padr√£o
                };
                
                // Salvar no localStorage para uso futuro
                localStorage.setItem(`competicao_${competicaoId}`, JSON.stringify(dadosCompeticao));
            }
            
            // Preparar dados para edi√ß√£o
            prepararDadosParaEdicao(competicaoId, dadosCompeticao);
            
            return true;
        }
        
        // Fun√ß√£o para preparar dados para edi√ß√£o
        function prepararDadosParaEdicao(competicaoId, dadosCompeticao) {
            // Armazenar dados b√°sicos no localStorage para edi√ß√£o
            localStorage.setItem('competicaoId', competicaoId);
            localStorage.setItem('nomeCompeticao', dadosCompeticao.nome);
            localStorage.setItem('tipoCompeticao', dadosCompeticao.tipo || 'individual');
            
            // Armazenar outros dados relevantes se existirem
            if (dadosCompeticao.formatosSelecionados) {
                localStorage.setItem('formatosSelecionados', JSON.stringify(dadosCompeticao.formatosSelecionados));
            }
            
            if (dadosCompeticao.criteriosPontuacao) {
                localStorage.setItem('criteriosPontuacao', JSON.stringify(dadosCompeticao.criteriosPontuacao));
            }
            
            if (dadosCompeticao.jogadoresList) {
                localStorage.setItem('jogadoresList', JSON.stringify(dadosCompeticao.jogadoresList));
            }
            
            if (dadosCompeticao.emparelhamentos) {
                localStorage.setItem('emparelhamentos', JSON.stringify(dadosCompeticao.emparelhamentos));
            }
            
            // Registrar que estamos em modo de edi√ß√£o
            localStorage.setItem('modoEdicao', 'true');
        }
        
        // Fun√ß√£o para ir para uma etapa espec√≠fica do processo de cria√ß√£o
        async function irParaEtapa(controller) {
            // Verificar se h√° uma competi√ß√£o carregada
            if (!carregarDadosCompeticaoAtual()) {
                return;
            }
            
            // Estamos em modo de edi√ß√£o, permitir navega√ß√£o livre
            localStorage.setItem('modoEdicao', 'true');
            
            // Obter o ID da competi√ß√£o do localStorage
            const competicaoId = localStorage.getItem('competicaoId');
            if (!competicaoId) {
                alert('ID da competi√ß√£o n√£o encontrado.');
                return;
            }
            
            // Redirecionar para a etapa selecionada, incluindo edicao e id na URL
            window.location.href = `/${controller}?edicao=true&competicaoId=${competicaoId}`;
        }

        document.addEventListener('DOMContentLoaded', function () {
            let competicaoId = @ViewBag.CompeticaoId;
            let competicaoNome = "@ViewBag.CompeticaoNome";
            const tabelaResultados = document.querySelector('.section table');
            const prevBtn = document.getElementById('prevDayBtn');
            const nextBtn = document.getElementById('nextDayBtn');
            const dateDisplay = document.getElementById('selectedDateDisplay');

            // Se n√£o houver competicaoId na ViewBag, tenta obter do localStorage
            if (!competicaoId) {
                const storedId = localStorage.getItem('competicaoSelecionadaId');
                if (storedId && !isNaN(parseInt(storedId))) {
                    competicaoId = parseInt(storedId);
                    competicaoNome = localStorage.getItem('competicaoSelecionada') || "Competi√ß√£o";
                    
                    // Redirecionar para a mesma p√°gina com o ID na URL para manter a consist√™ncia
                    window.location.href = '/Menu?competicaoId=' + competicaoId;
                    return;
                } else {
                    alert('Nenhuma competi√ß√£o selecionada. Redirecionando para a p√°gina de competi√ß√µes.');
                    window.location.href = '/Competicoes';
                    return;
                }
            }
            
            // Carregar a tabela classificativa
            function carregarTabelaClassificativa() {
                const tabelaClassificativa = document.querySelector('.content-wrapper table:first-of-type');
                const tbody = tabelaClassificativa.querySelector('tbody');
                
                // Limpar a tabela existente
                tbody.innerHTML = '';
                
                // Adicionar linha de carregamento
                const loadingRow = document.createElement('tr');
                loadingRow.innerHTML = '<td colspan="9">Carregando dados...</td>';
                tbody.appendChild(loadingRow);
                
                console.log(`Carregando tabela classificativa para competi√ß√£o ID: ${competicaoId}`);
                
                // Buscar dados do servidor
                fetch(`/Menu/ObterTabelaClassificativa?competicaoId=${competicaoId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erro ao obter tabela classificativa: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Dados da tabela classificativa recebidos:', data);
                        
                        // Limpar a tabela novamente
                        tbody.innerHTML = '';
                        
                        if (!data || data.length === 0) {
                            const row = document.createElement('tr');
                            row.innerHTML = '<td colspan="9">Nenhum dado dispon√≠vel para esta competi√ß√£o.</td>';
                            tbody.appendChild(row);
                            return;
                        }
                        
                        // Adicionar dados reais
                        data.forEach(clube => {
                            const row = document.createElement('tr');
                            
                            // Criar c√©lulas para forma
                            let formaHTML = '';
                            if (clube.forma && clube.forma.length > 0) {
                                clube.forma.forEach(f => {
                                    let classeForma = '';
                                    if (f === 'V') classeForma = 'form-v';
                                    else if (f === 'E') classeForma = 'form-e';
                                    else if (f === 'D') classeForma = 'form-d';
                                    
                                    formaHTML += `<span class="form-box ${classeForma}">${f}</span>`;
                                });
                            }
                            
                            row.innerHTML = `
                                <td>${clube.posicao}</td>
                                <td>${clube.nome}</td>
                                <td>${clube.jogos}</td>
                                <td>${clube.vitorias}</td>
                                <td>${clube.empates}</td>
                                <td>${clube.derrotas}</td>
                                <td>${clube.frames}</td>
                                <td>${clube.pontuacao}</td>
                                <td>${formaHTML}</td>
                            `;
                            
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao carregar tabela classificativa:', error);
                        tbody.innerHTML = '';
                        const row = document.createElement('tr');
                        row.innerHTML = `<td colspan="9">N√£o foi poss√≠vel carregar a tabela classificativa: ${error.message}</td>`;
                        tbody.appendChild(row);
                    });
            }
            
            // Chamar a fun√ß√£o para carregar a tabela classificativa
            carregarTabelaClassificativa();
            
            // Recarregar a tabela classificativa a cada 5 segundos para manter os dados atualizados
            setInterval(carregarTabelaClassificativa, 5000);

            // Atualiza o t√≠tulo da sec√ß√£o
            const h2 = document.querySelector('.section h2');
            h2.textContent = `Resultados ‚Äì ${competicaoNome}`;

            // Estado de data atual
            let currentDate;
            
            // Verificar se h√° uma data no URL
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                // Tentar converter a string para Date
                const dataParts = dataParam.split('-');
                if (dataParts.length === 3) {
                    // Formato esperado: yyyy-MM-dd
                    const year = parseInt(dataParts[0]);
                    const month = parseInt(dataParts[1]) - 1; // M√™s em JavaScript √© 0-11
                    const day = parseInt(dataParts[2]);
                    
                    currentDate = new Date(year, month, day);
                    console.log('Data do URL:', dataParam, 'convertida para:', currentDate);
                } else {
                    currentDate = new Date();
                }
            } else {
                currentDate = new Date();
            }

            function formatDate(date) {
                // Garantir que a data est√° no formato yyyy-MM-dd
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            function formatDisplayDate(date) {
                return date.toLocaleDateString('pt-PT', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            }

            function updateDateDisplay() {
                dateDisplay.textContent = formatDisplayDate(currentDate);
            }
            
            function carregarResultados() {
                // Limpa todas as linhas exceto o cabe√ßalho
                const rows = tabelaResultados.querySelectorAll('tr');
                rows.forEach((row, index) => { if (index > 0) row.remove(); });
                
                // Adicionar linha de carregamento
                const loadingRow = document.createElement('tr');
                loadingRow.innerHTML = `<td colspan="4">Carregando dados...</td>`;
                tabelaResultados.appendChild(loadingRow);
                
                // Atualizar a data exibida
                updateDateDisplay();
                
                const dataFiltrada = formatDate(currentDate);
                
                console.log(`Buscando resultados para competi√ß√£o ${competicaoId} na data ${dataFiltrada}`);
                
                // Buscar dados do servidor - Garantir que a data seja passada corretamente
                fetch(`/Menu/ObterResultados?competicaoId=${competicaoId}&data=${encodeURIComponent(dataFiltrada)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erro ao obter resultados: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Dados de resultados recebidos:', data);
                        
                        // Limpar tabela novamente
                        const rows = tabelaResultados.querySelectorAll('tr');
                        rows.forEach((row, index) => { if (index > 0) row.remove(); });
                        
                        if (!data.emparelhamentos || data.emparelhamentos.length === 0) {
                            const row = document.createElement('tr');
                            row.innerHTML = `<td colspan="4">Nenhum jogo agendado para esta data.</td>`;
                            tabelaResultados.appendChild(row);
                            return;
                        }
                        
                        // Recarregar a tabela classificativa ap√≥s carregar os resultados
                        // para garantir que a tabela esteja atualizada com os √∫ltimos resultados
                        carregarTabelaClassificativa();
                        
                        // Adicionar dados reais quando dispon√≠veis
                        data.emparelhamentos.forEach(jogo => {
                            const row = document.createElement('tr');
                            
                            let resultado = 'Por definir';
                            if (jogo.jogoRealizado) {
                                resultado = `${jogo.pontuacaoClube1} - ${jogo.pontuacaoClube2}`;
                            }
                            
                            // Verificar o tipo de competi√ß√£o
                            const tipoCompeticao = localStorage.getItem('tipoCompeticao') || '';
                            const isIndividual = tipoCompeticao !== 'equipas';
                            
                            // Criar c√©lulas para cada coluna
                            row.innerHTML = `
                                <td>${jogo.clube1} vs ${jogo.clube2}</td>
                                <td>${jogo.horario}</td>
                                <td>${resultado}</td>
                                <td>${jogo.motivo !== undefined ? jogo.motivo : ''}</td>
                            `;
                            
                            // Adicionar classe para destacar jogos realizados
                            if (jogo.jogoRealizado) {
                                row.classList.add('jogo-realizado');
                            }
                            
                            // Adicionar classe para diferenciar jogos individuais
                            if (isIndividual) {
                                row.classList.add('jogo-individual');
                            }
                            
                            tabelaResultados.appendChild(row);
                        });
                        
                        // Adicionar informa√ß√µes de depura√ß√£o
                        console.log(`Total de emparelhamentos na competi√ß√£o: ${data.totalEmparelhamentos}`);
                        console.log(`Emparelhamentos para a data ${data.dataFormatada}: ${data.emparelhamentos.length}`);
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                        // Limpar tabela novamente
                        const rows = tabelaResultados.querySelectorAll('tr');
                        rows.forEach((row, index) => { if (index > 0) row.remove(); });
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `<td colspan="4">N√£o foi poss√≠vel carregar os resultados. Por favor, tente novamente mais tarde.</td>`;
                        tabelaResultados.appendChild(row);
                        
                        // Registrar o erro no console para depura√ß√£o
                        console.error('Detalhes do erro:', error);
                    });
            }

            // Bot√µes para navegar entre dias
            prevBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() - 1);
                updateDateDisplay();
                carregarResultados();
            });

            nextBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() + 1);
                updateDateDisplay();
                carregarResultados();
            });

            // Fun√ß√£o para ir para a p√°gina de pontua√ß√µes
            window.irParaPontuacoes = function() {
                const dataFormatada = formatDate(currentDate);
                console.log('Indo para pontua√ß√µes com data:', dataFormatada);
                
                // Armazenar o ID da competi√ß√£o no localStorage para persist√™ncia
                localStorage.setItem('competicaoSelecionadaId', competicaoId);
                
                // Armazenar a data selecionada para persist√™ncia
                localStorage.setItem('dataSelecionada', dataFormatada);
                
                // Redirecionar para a p√°gina de pontua√ß√µes com a data no URL
                window.location.href = `/Pontuacoes?competicaoId=${competicaoId}&data=${encodeURIComponent(dataFormatada)}`;
            };
            


            // Inicializa√ß√£o
            updateDateDisplay();
            
            // Primeiro carrega a tabela classificativa
            carregarTabelaClassificativa();
            
            // Depois carrega os resultados
            carregarResultados();
        });
    </script>
    <!-- Modal para motivo de vit√≥ria -->
    <div id="motivoModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:1000; align-items:center; justify-content:center;">
        <div style="background:white; padding:32px; border-radius:12px; max-width:400px; margin:120px auto; position:relative;">
            <h3>Motivo da Vit√≥ria</h3>
            <input type="hidden" id="motivoInputIdx" />
            <input type="hidden" id="motivoModalVencedor" />
            <input type="hidden" id="motivoModalJ1" />
            <input type="hidden" id="motivoModalJ2" />
            <textarea id="motivoVitoria" style="width:100%; min-height:60px; margin-top:12px; font-size:16px; border-radius:8px; border:1px solid #333;" placeholder="Descreva o motivo..."></textarea>
            <div style="margin-top:18px; text-align:right;">
                <button onclick="confirmarMotivo()" class="btn">Confirmar</button>
                <button onclick="cancelarMotivo()" class="btn" style="margin-left:10px;">Cancelar</button>
            </div>
        </div>
    </div>
    

<script>
function irParaProximosJogos() {
    // Tenta obter o ID salvo da competi√ß√£o
    const competicaoId = localStorage.getItem('competicaoId') || localStorage.getItem('competicaoSelecionadaId');
    if (competicaoId) {
        window.location.href = `/ProximosJogos?competicaoId=${competicaoId}`;
    } else {
        alert('Nenhuma competi√ß√£o selecionada.');
    }
}
</script>
</body>
</html>
